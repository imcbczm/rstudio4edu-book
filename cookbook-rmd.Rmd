# (PART) Cookbook: R Markdown sites {-}

```{r, include = FALSE}
source("common.R")
knitr::opts_chunk$set(fig.align="center")
```

# Introduction {-#intro-rmd}

<center>![](images/rmd_custom/rmd_site.jpg){width=30%}</center>

This is a cookbook intended for folks who would like to put together a site to help them organize and deliver their teaching materials to learners. The R Markdown site is arguably the simplest way to compile a collection of R Markdown documents.

<!--todo: insert screenshots or iframes with links to existing R Markdown sites-->

Using R Markdown project templates, you can put together a bare-bones site in no time at all. Here, we will show you an example of how to do this by making a demo site. You can follow along with this cookbook, or you can download the demo repositories modify as much as you'd like. 


<div class = side-by-side>
<div class = side1>

```{r echo = FALSE, fig.align='center', fig.link = "#make-rmd"}
knitr::include_graphics("images/rmd_custom/intro-rmd.jpg")
```

</div>
<div class = side2>

<h4>[Make a site](#make-rmd)</h4>
You will build a bare-bones R Markdown website from a site skeleton and publish it. We make only the most minimal changes to content and style necessary to get you a shareable website.

</div>
</div>

\

<div class = side-by-side>
<div class = side1>

```{r, fig.align='center', echo= FALSE, fig.link = "#rmd-care"}
knitr::include_graphics("images/rmd_custom/Caring.jpg")
```

</div>
<div class = side2>

<h4>[Caring for your site](#rmd-care)</h4>
You'll develop a workflow for editing your site, adding new content, and hiding pages that are works-in-progress.

</div>
</div>

\

<div class = side-by-side>
<div class = side1>

```{r, fig.align='center', echo= FALSE, out.width="50%", fig.link = "#rmd-dress"}
knitr::include_graphics("images/rmd_custom/Dressup.jpg")
```

</div>
<div class = side2>

<h4>[Dress it up](#rmd-dress)</h4>

Here, you'll find instructions for no-fuss website customizations that leverage built-in features that *do not* rely on knowing or using CSS.

</div>
</div>

\

<div class = side-by-side>
<div class = side1>
<!--todo: insert fancy image here?-->
</div>

<div class = side2>

<h4>[Make it fancier](#rmd-fancy)</h4>

In the final chapter, you'll learn about website customizations that require some CSS and HTML.

</div>
</div>


## Pros and cons of using Rmd sites {-}


**Pros:**

* **Minimal additions** (really, just 2 files) are needed to go from a collection of regular R Markdown documents to a site.  

* **Minimal software dependencies** (really, only `rmarkdown`) is needed to build your site- no additional software is required.

* **A simple structure** allows you to grow your content and add pages quickly, without having to invest time in learning complicated folder structures to figure out where to put new files.  

* **Ideal for small sites** that do not need complex organization or many pages (i.e. for workshops).  

* **Easy to customize** without any knowledge of web design or CSS if you're okay sticking to the templates. 


\

**Cons:**

* **Many files lead to chaos** because there is not a way to organize files so that they fall under the umbrella of an overarching page. All R Markdown docs and pages will be on the same "level" of website organization, so as the number of pages increases, your project directory becomes increasingly crowded. 

<!--the wording above isn't totally clear re: "umbrella". You may want to mention that it is not possible to organize your website pages within subdirectories- every .Rmd file has to be in the "root" project directory, and show a mock directory tree-->

* **CSS and HTML necessary** for moving beyond the limited built-in customization options. Depending on what you enjoy about coding--this might not actually be a con. 


## Is this cookbook for you? {-}

```{r child ="modules/is-this-tutorial-for-you.Rmd"}

```

* How to compile multiple R Markdown pages into an R Markdown site
* How to add basic customization through themes using built-in options
* Optionally, how to customize your site even further with CSS
* How to publish your R Markdown pages for free via GitHub Pages


\

Let's get started! 


## Other learning resources {-}

* [Lisa Debruine's *Create a simple webpage using R Markdown*](https://debruine.github.io/tutorials/webpages.html): Includes some overview of adding images, changing global style settings, etc.  

* [Emily Zabor's *Creating Website in R*](https://www.emilyzabor.com/cookbooks/rmarkdown_websites_tutorial.html#r_markdown_website_basics): Includes description of how to add a personal domain name.

* [Julia Lowndes' *Making free websites with RStudio's R Markdown*](https://jules32.github.io/rmarkdown-website-tutorial/index.html): A how to that also includes descriptions of the RStudio GUI layout and an overview of Markdown syntax.  

* [Nick Strayer & Lucy Dâ€™Agostino McGowan's *How to make an RMarkdown Website*](http://nickstrayer.me/RMarkdown_Sites_tutorial/)  

* [R Markdown: The Definitive Guide](https://bookdown.org/yihui/rmarkdown/rmarkdown-site.html): The official and very thorough, but often technical, resource for R Markdown. Treat this as a reference text.

* [GitHub and Rstudio](https://resources.github.com/whitepapers/github-and-rstudio/): Step-by-step guide on publishing `.Rmd` docs and websites to GitHub, includes working with local branches and using the terminal tab within R. 



# Make a site {#make-rmd}

<center>![](images/rmd_custom/intro-rmd.jpg){width=70%}</center>


What are we going to make here? We're about to take a collection of (one or more) R Markdown files, create `.html` versions of each, and "knit" them together into a single, navigable website. This is not so different from what happens when you work with individual `.Rmd`s. But, there are a few key pieces of magic that separate a directory filled with R Markdown files from a living, breathing website: 

<center>![](images/rmd_custom/thread_yaml.jpg)</center>

* **A `_site.yml` text file** that will stitch your `.Rmd` documents together and place an official-looking navigation bar at the top of them.

* **An R Markdown file** with the name `index.Rmd` file, which will become your site's homepage.

Additionally, we'll demo how to publish your R Markdown site using GitHub Pages, so you'll also need:

* **A `docs/` folder**, which will be the folder that acts as the "boarding area" for your rendered site files, and which you need if you're deploying on GitHub pages.

* To **turn on GitHub Pages for your repository**.

There are certainly other options for publishing as you can copy the output directory to any web server or web hosting service. For an overview of other options, you may reference: https://rstudio.github.io/distill/publish_website.html.


## tl;dr

**Here's how you make an R Markdown site:**

<!--begin Alison's revised tldr-->

1. Start with an empty RStudio project linked to a remote GitHub repository that you can push/pull to from your local copy in RStudio.

1. In your project, create a simple shell for an R Markdown website shell by running the following code in your R console:

    ```{r rmd-skeleton, eval = FALSE}
    rmarkdown:::site_skeleton(getwd())
    ```
    
1. Prep for publishing to GitHub pages with two steps:

    + Change the output directory of your website to a folder named `"docs"` from
    
    + Tell GitHub Pages to bypass using Jekyll to build your site.

1. Build your site using the RStudio "Build" pane.

1. Push and commit to send your site online to GitHub- do you see your `.html` files in the `"docs"` folder?

1. Turn on GitHub Pages by going to your repository settings online.

1. Edit your site, build it, then push and commit to GitHub to publish your changes online.

1. Rinse and repeat! Every push to your `master` branch triggers the online version of your site to update.

* **A `_site.yml` text file** that will stitch your `.Rmd` documents together and place an official-looking navigation bar at the top of them.
* **An R Markdown file** with the name `index.Rmd` file, which will become your site's homepage.
* **A `docs/` folder**, which will be the folder that acts as the "boarding area" for your rendered site files, and which you need if you're deploying on GitHub pages.
* **GitHub Pages for your repository**, turned on with the click of a button to make your work go live!


<!--end Alison's revised tldr-->

[1.](#rmd-getting-started) In a GitHub-connected RStudio project, run `rmarkdown:::site_skeleton(getwd())` to create the files you need.
\

[2.](#rmd-edit) Edit `index.Rmd` content to be with whatever you want to put on your homepage. Edit the `about.Rmd`, which will be your second page.
\

[3.](#rmd-edit) Within `_site.yml`, change the output directory to the `docs/` folder so you can be set up for GitHub pages.
\ 

[4.](#rmd-edit) Run `rmarkdown::render_site()` each time you make changes to any doc to create `.html` file versions of your `.Rmd` pages.
\

[5.](#rmd-push) Commit and push all changes to GitHub.
\

[6.](#rmd-living) Go to your GitHub repo > *Settings* > *scroll down to GitHub pages* > *select "master branch/ docs folder" from the dropdown menu*. Share your new site URL!
\

[7.](#rmd-dress) Customize your site with built-in YAML options.
\

[8.](#new-rmd) Add new pages by creating new `.Rmd`s, deleting their individual YAML info, except for the `Title:` and the dashed lines.
\

[9.](#rmd-one-yaml) Link new page to the site by referencing it in the navbar section of `_site.yml`.
\

[10.](#new-rmd) Always end by knitting or rendering and then pushing to GitHub. 
\



## Getting set up
```{r, out.width = "20%", fig.align='center', echo= FALSE}
knitr::include_graphics("images/Gears.jpg")
```

### Packages

The only package you need for this cookbook is `rmarkdown` but if you are using RStudio, you are all set!

:::rstudio-tip
The `rmarkdown` package does not need to be explicitly installed or loaded here, as RStudio automatically does both when needed. 
:::

However, if you haven't updated your package recently (or ever), you can re-install it to make sure you are using the most up-to-date version from CRAN:

```{r eval = FALSE}
install.packages("rmarkdown")
```

### A project {#rmd-github-first}

For your first R Markdown site, we recommend starting by created a GitHub repository online first, then making a project in RStudio. 

<!--TODO: add link to other workflow that we recommend later-->

```{r child = 'modules/github-first-project.Rmd'}

```

## Your first website {#rmd-getting-started}

We'll start by creating the shell for a basic R Markdown website and showing you how to publish your site on GitHub Pages. In a later section, we show you how to customize and care for your site.

```{r ref.label = 'rmd-skeleton', eval = FALSE}
```

:::tip
Warning! Note that we use `:::` here (with three colons!) to generate important infrastructure files we need.

:::

\

You will end up with the following files in your working directory, as shown in Figure \@ref(fig:rmd-site-dir). The most critical files are the `index.Rmd` and the `_site.yml`, and we mention a little about them below. 

```{r rmd-site-dir, echo = FALSE, out.width="300px", fig.cap="Site skeleton"}
knitr::include_graphics("images/rmd_custom/rmd_tutorial.png")
```



Close RStudio and re-open your site by clicking on the project file (`.Rproj`). When you re-open the project, you may notice the `.Rproj` file shows up in your Git pane, which means that the file has changed since your last commit. What happened? RStudio has detected that you have built a website, so a single line has been added to your `.Rproj` file:

```yaml
BuildType: Website
```

## Push to GitHub {#rmd-push}

Let's get these website files pushed up to our remote repository on GitHub. Do the following from RStudio:

1. **Click *Git* ** in the same RStudio pane that also contains the *Environment* tab.

2. **Check the box(es)** under the "Staged" column and click *Commit*.

3. **Add a commit message** like "initial commit" and then click *Push*.

<center>![](images/rmd_custom/git1.png){width=400px}<center>


## Edit > Build > Preview {#rmd-edit}

Our skeleton created two out-of-the-box content files for our site: 

1. `index.Rmd`

1. `about.Rmd` 

When we build our site, R Markdown will *knit* each of these, and create `.html` (i.e. website-ready) versions of them that we can preview locally. The third file in our skeleton, `_site.yml`, is not a file that gets turned into a site page but is necessary for site setup. 


1. **Open `index.Rmd`**. Make a minimal change like changing the Title here. Any content on this page will be your site's homepage. This file *must* be named "index.Rmd". **Save**.


1. **Open `about.Rmd`.** Make a minimal change, like adding another sentence about yourself, your project, your dog- anything. This will be a second, distinct page of your site. This file can have any name, but we will stick to "about" for now. **Save**.

1. **Open `_site.yml` and add the following** on its own line at the end:

    ```{r, eval = FALSE}
    output_dir: "docs"
    ```

    This step is a one-time step. It says: 
    
    > "Please take all of my `.html` files that I will make when I *build*, and place them in the `docs/` folder. And if there's not a `docs/` folder, then make one." 
    
    Having our HTML files live in `docs/` is necessary for using GitHub pages put make our pages go live, which we'll do soon. You do *not* need this step if you will not be publishing to GitHub Pages.
    
    
1. In RStudio, find the Build tab (usually in the upper right pane, right next to the Git tab) and select **Build Website** to render your new website locally.

    ```{r echo = FALSE, fig.link = "https://bookdown.org/yihui/rmarkdown/", fig.cap="The build pane in RStudio"}
    knitr::include_graphics("https://bookdown.org/yihui/rmarkdown/images/site-build.png")
    ```
    

    Alternatively, you can render your site (knit + preview all .Rmd files in one fell swoop) from the R console using `rmarkdown`'s `render_site()` function.  

    ```{r, eval = FALSE}
    rmarkdown::render_site()
    ```

    This is a step you will do a lot as you create your site. What does this do? This processes your `.Rmd`s and creates the `docs/` folder (if it doesn't already exist) that houses `.html` versions of each of your `.Rmd` files. AND each of these pages now has a common navigation bar at the top that links your site together (this is thanks to our `_site.yml` file--but more on that later).

:::tip
If the rendered site does not open up automatically in a new window, you can go to the `docs/` folder in your project, click on the `index.html` file, and `View it in Web Browser`.
:::

:::tip
Note: Editing your `.Rmd` files, building your site, and then pushing to GitHub are steps you'll do *many* times as you build up your content. Working with your `_site.yml` file is usually something you only mess with intially as you set up your site.

:::

## Push to GitHub (again) {#rmd-push2}

Let's get these *new* website files pushed up to our remote repository on GitHub. If you want your site to have the most recent updates you've made, then every single `.Rmd` file with a change must be built right *before* pushing to GitHub. Using either the build pane or `rmarkdown::render_site()`, you don't need to knit each `.Rmd` file one at a time, but you do need to build your site locally first every time.

:::tip
Watch out! Each time you run `rmarkdown::render_site()`, the `docs/` folder will be overwritten with updated HTML versions of your `.Rmd`s. This means DON'T EVER EDIT FILES IN THE `docs/` FOLDER! Nothing catastrophic will happen if you do, but you will overwrite and lose all your changes the next time you knit or `render_site()`.
:::

\
Go ahead and stage all your changed files, commit, and push to GitHub.

:::tip

If at this point you somehow ended up with a folder called `_site/` in your project directory, go ahead and delete it. You don't need it. This is just the default version of the `docs/` folder, and if you have it, it just means you must have knit or rendered your site before we specified `output_dir: "docs"` in `_site.yml`.
:::

<!--todo: we need to tell them how to remove that dir if pushed-->

Now we'll get to the good stuff! Let's put this on the internet!



## Make a living, breathing site! {#rmd-living}

We have built some out-of-the-box content and pushed to GitHub. Now we'll go back to the GitHub website and tell it where to find our website-ready files:


```{r, child= "modules/github-pages.Rmd"}

```
\

Now that the bare bones of the site are up, you can go back and add more content to your R Markdown documents anytime. Your changes will go live as soon as you build or `render_site()`, followed by a push to GitHub. 





## Your second website

We followed a "GitHub first" workflow above, but if you'll be using GitHub regularly, we recommend evolving this workflow. First, install the `usethis` package:

```{r eval = FALSE}
install.packages("usethis")
```

Then load it to use it:

```{r message = FALSE, warning = FALSE}
library(usethis)
```

Now, follow the instructions from [Happy Git with R setting up a GitHub personal access token or PAT](https://happygitwithr.com/github-pat.html).

Once you have a GitHub PAT set up in your `.Renviron` file, you can stay in RStudio and use the RStudio project wizard to create a new R Markdown site:

1. **Click** *File* > *New Project* > *New Directory*

1. **Scroll down and select** *Simple R Markdown Website*

1. Then use your R console to **run** this code: 

    ```{r, eval=FALSE}
    use_git()
    use_github() # you have to have a PAT setup
    ```






